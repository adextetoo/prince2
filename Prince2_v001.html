<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRINCE2 Foundation Exam Simulator</title>
    <style>
        :root {
            --primary-color: #0975f1; /* UPDATED from #1a5276 - For header, default button hover */
            --secondary-color: #2e86c1; /* Default button color */
            --accent-color: #0975f1; /* UPDATED from #3498db - For selected option, option hover border */
            --light-color: #eaf2f8;
            --dark-color: #2c3e50;
            --success-color: #27ae60; /* Submit button */
            --error-color: #e74c3c;
            --warning-color: #f39c12; /* Timer warning */
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color); /* Will now be #0975f1 */
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .subheader {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .info-panel {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timer {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00e05a; /* UPDATED - Was var(--primary-color) */
            background-color: var(--light-color);
            padding: 10px 20px;
            border-radius: 5px;
        }
        
        .timer.warning {
            color: var(--warning-color); /* Stays #f39c12 */
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .question-card {
            background-color: white;
            border-radius: 5px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .question-number {
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            display: flex;
            align-items: flex-start;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option:hover {
            background-color: var(--light-color);
            border-color: var(--accent-color); /* Will now be #0975f1 */
        }
        
        .option.selected {
            background-color: var(--accent-color); /* Will now be #0975f1 */
            color: white;
            border-color: var(--accent-color); /* UPDATED - to match background, was var(--secondary-color) */
        }
        
        .option.correct {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        
        .option.incorrect {
            background-color: var(--error-color);
            color: white;
            border-color: var(--error-color);
        }
        
        .option input {
            margin-right: 15px;
            margin-top: 3px;
        }
        
        .option-text {
            flex: 1;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            background-color: var(--secondary-color); /* Default button color #2e86c1 */
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.2s ease;
        }
        
        button:hover {
            background-color: var(--primary-color); /* Default button hover #0975f1 */
        }

        /* Specific style for Next Button */
        #nextBtn {
            background-color: #00e05a; /* UPDATED */
        }
        #nextBtn:hover {
            background-color: #00c751; /* UPDATED - Darker shade of #00e05a */
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .submit-btn {
            background-color: var(--success-color); /* #27ae60 */
        }
        
        .submit-btn:hover {
            background-color: #219653; /* Darker shade of success */
        }
        
        #welcomeScreen,
        #examScreen,
        #resultsScreen {
            transition: all 0.3s ease;
        }
        
        #examScreen,
        #resultsScreen {
            display: none;
        }
        
        .welcome-card {
            background-color: white;
            border-radius: 5px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .welcome-card h2 {
            color: var(--primary-color); /* Will now be #0975f1 */
            margin-bottom: 20px;
        }
        
        .welcome-card p {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .welcome-card ul {
            text-align: left;
            margin: 20px 0;
            padding-left: 20px;
        }
        
        .welcome-card li {
            margin-bottom: 10px;
        }
        
        .welcome-card button {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 1.2rem;
        }
        
        .results-card {
            background-color: white;
            border-radius: 5px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .score-summary {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .score {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary-color); /* Will now be #0975f1 */
            margin: 20px 0;
        }
        
        .score-message {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .score-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .detail-item {
            text-align: center;
            padding: 15px;
            border-radius: 5px;
            min-width: 150px;
        }
        
        .detail-item.correct {
            background-color: rgba(39, 174, 96, 0.1);
            border: 1px solid var(--success-color);
        }
        
        .detail-item.incorrect {
            background-color: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--error-color);
        }
        
        .detail-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .detail-label {
            font-size: 1rem;
            color: var(--dark-color);
        }
        
        .review-heading {
            margin: 30px 0 20px;
            color: var(--primary-color); /* Will now be #0975f1 */
            text-align: center;
        }
        
        .review-item {
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        
        .review-question {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }
        
        .review-options {
            margin-left: 20px;
        }
        
        .review-option {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 3px;
        }
        
        .user-answer {
            background-color: rgba(231, 76, 60, 0.1);
            border-left: 3px solid var(--error-color);
        }
        
        .correct-answer {
            background-color: rgba(39, 174, 96, 0.1);
            border-left: 3px solid var(--success-color);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .review-toggle {
            cursor: pointer;
            color: var(--secondary-color);
            text-decoration: underline;
            margin-top: 20px;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .score-details {
                flex-direction: column;
                gap: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            button {
                width: 100%;
            }
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>PRINCE2® Foundation Exam Simulator</h1>
            <div class="subheader">Test your knowledge with realistic exam-style questions created by Taiwo Adekola</div>
        </div>
    </header>
    
    <main class="container">
        <!-- Welcome Screen -->
        <section id="welcomeScreen">
            <div class="welcome-card">
                <h2>Welcome to the PRINCE2® Foundation Exam Simulator</h2>
                <p>This simulator will help you prepare for the PRINCE2 Foundation certification exam.</p>
                
                <ul>
                    <li><strong>Time Limit:</strong> 60 minutes</li>
                    <li><strong>Question Format:</strong> Multiple choice with one correct answer</li>
                    <li><strong>Question Pool:</strong> Over 500 questions (simulated with available data)</li>
                    <li><strong>Passing Score:</strong> 55% (33 out of 60 questions)</li>
                </ul>
                
                <p>You will be presented with a set of 60 randomly selected questions from our comprehensive database. Once you submit your exam or when the time runs out, you'll receive detailed results showing your performance.</p>
                
                <button id="startExamBtn">Start Exam</button>
            </div>
        </section>
        
        <!-- Exam Screen -->
        <section id="examScreen">
            <div class="info-panel">
                <div>
                    <div>Question <span id="currentQuestionNum">1</span> of <span id="totalQuestions">60</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="timer" id="timer">60:00</div>
            </div>
            
            <div class="question-card">
                <div class="question-number">Question <span id="questionNumber">1</span></div>
                <div class="question-text" id="questionText">Loading question...</div>
                
                <div class="options" id="options">
                    <!-- Options will be added dynamically -->
                </div>
                
                <div class="navigation">
                    <button id="prevBtn" disabled>Previous</button>
                    <button id="nextBtn">Next</button>
                    <button id="submitBtn" class="submit-btn">Submit Exam</button>
                </div>
            </div>
        </section>
        
        <!-- Results Screen -->
        <section id="resultsScreen">
            <div class="results-card">
                <div class="score-summary">
                    <h2>Exam Results</h2>
                    <div class="score"><span id="scorePercentage">0</span>%</div>
                    <div class="score-message" id="scoreMessage">Loading results...</div>
                </div>
                
                <div class="score-details">
                    <div class="detail-item correct">
                        <div class="detail-value" id="correctAnswers">0</div>
                        <div class="detail-label">Correct</div>
                    </div>
                    <div class="detail-item incorrect">
                        <div class="detail-value" id="incorrectAnswers">0</div>
                        <div class="detail-label">Incorrect</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="retakeBtn">Take New Exam</button>
                    <button id="reviewBtn">Review Answers</button>
                </div>
                
                <div id="reviewSection" style="display: none;">
                    <h3 class="review-heading">Review Your Answers</h3>
                    <div id="reviewContent">
                        <!-- Review content will be added dynamically -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // PRINCE2 Foundation Exam Questions Database
        // This const represents the master source of questions,
        // conceptually like data fetched from a server or a separate module.
        const questionsDatabase = [
            {
                question: "Which PRINCE2 principle emphasizes learning from experience?",
                options: [
                    "Continued business justification",
                    "Manage by stages",
                    "Learn from experience",
                    "Focus on products"
                ],
                correct: 2
            },
            {
                question: "Which role is responsible for ensuring that the project produces the required products to specified standards within identified constraints?",
                options: [
                    "Executive",
                    "Project Manager",
                    "Team Manager",
                    "Senior User"
                ],
                correct: 1
            },
            {
                question: "Which PRINCE2 principle emphasizes that a project must provide value for money?",
                options: [
                    "Continued business justification",
                    "Learn from experience",
                    "Define roles and responsibilities",
                    "Focus on products"
                ],
                correct: 0
            },
            {
                question: "Which management product contains details of how benefits will be measured?",
                options: [
                    "Business Case",
                    "Project Brief",
                    "Project Initiation Documentation",
                    "Benefits Management Approach"
                ],
                correct: 3
            },
            {
                question: "Which is NOT a purpose of the Change theme?",
                options: [
                    "Assess and control anything that might impact the project's baseline",
                    "Establish mechanisms to determine whether the project is desirable, viable and achievable",
                    "Prevent changes to baselined products without proper consideration of the impact",
                    "Ensure that the focus on products is maintained throughout the project"
                ],
                correct: 1
            },
            {
                question: "Which is NOT a PRINCE2 principle?",
                options: [
                    "Learn from experience",
                    "Manage by exception",
                    "Focus on products",
                    "Detailed planning"
                ],
                correct: 3
            },
            {
                question: "Which PRINCE2 theme provides mechanisms for controlling deviations?",
                options: [
                    "Risk",
                    "Change",
                    "Progress",
                    "Quality"
                ],
                correct: 1
            },
            {
                question: "Which theme is responsible for establishing mechanisms to judge whether the project is desirable, viable and achievable?",
                options: [
                    "Organization",
                    "Business Case",
                    "Progress",
                    "Plans"
                ],
                correct: 1
            },
            {
                question: "Which process covers the activities required by the Project Board to authorize project closure?",
                options: [
                    "Directing a Project", 
                    "Controlling a Stage",
                    "Managing Product Delivery",
                    "Managing a Stage Boundary"
                ],
                correct: 0 
            },
            {
                question: "Which defines the formats and standards to be used to develop the project's products?",
                options: [
                    "Project Brief",
                    "Project Approach",
                    "Project Product Description",
                    "Quality Management Approach"
                ],
                correct: 3
            },
            {
                question: "Which role is responsible for specifying the customer's quality expectations for the project?",
                options: [
                    "Executive",
                    "Senior User",
                    "Senior Supplier",
                    "Project Manager"
                ],
                correct: 1
            },
            {
                question: "What should be included in a Product Description?",
                options: [
                    "Only a description of the product's purpose",
                    "Only the quality criteria for the product",
                    "Only the development skills required",
                    "Purpose, composition, derivation, format, quality criteria and quality methods"
                ],
                correct: 3
            },
            {
                question: "What is the main purpose of a Highlight Report?",
                options: [
                    "To provide the Project Board with a summary of stage status",
                    "To request approval for a Stage Plan",
                    "To record and track project issues",
                    "To define the quality standards for the project"
                ],
                correct: 0
            },
            {
                question: "Which is the PRINCE2 principle that states that a project should be broken down into manageable, sequential steps?",
                options: [
                    "Learn from experience",
                    "Manage by stages",
                    "Focus on products",
                    "Manage by exception"
                ],
                correct: 1
            },
            {
                question: "When should risk probability and impact be assessed?",
                options: [
                    "Only at the beginning of the project",
                    "Only when creating the Risk Management Approach",
                    "Throughout the project as part of risk management",
                    "Only when risks are identified"
                ],
                correct: 2
            },
            {
                question: "Which is NOT a risk response type in PRINCE2?",
                options: [
                    "Reduce",
                    "Accept",
                    "Avoid",
                    "Ignore"
                ],
                correct: 3
            },
            {
                question: "Which is a purpose of the Closing a Project process?",
                options: [
                    "To recommend project closure to the Project Board",
                    "To prepare for the final stage of the project",
                    "To hand over responsibility for operations and maintenance",
                    "To review project performance"
                ],
                correct: 0
            },
            {
                question: "What is the purpose of a configuration item record?",
                options: [
                    "To record details of identified risks",
                    "To record the status of each product",
                    "To record project issues",
                    "To record the daily activities of the Project Manager"
                ],
                correct: 1
            },
            {
                question: "Which is NOT a method for quality control in PRINCE2?",
                options: [
                    "Testing",
                    "Inspection",
                    "Quality review",
                    "Management review"
                ],
                correct: 3
            },
            {
                question: "Which role is responsible for creating the Benefits Review Plan?",
                options: [
                    "Executive",
                    "Project Manager", 
                    "Senior User",
                    "Senior Supplier"
                ],
                correct: 1 
            },
            {
                question: "What information does a Risk Register contain?",
                options: [
                    "Only risk descriptions",
                    "Only risk owners",
                    "A list of identified risks including their status and history",
                    "Only risk response plans"
                ],
                correct: 2
            },
            {
                question: "Which describes a threat in PRINCE2?",
                options: [
                    "An uncertain event that could have a negative impact on objectives",
                    "An issue that has occurred",
                    "An uncertain event that could have a positive impact on objectives",
                    "A certain event that will have a negative impact on objectives"
                ],
                correct: 0
            },
            {
                question: "Which is a purpose of the 'Starting up a Project' process?",
                options: [
                    "To ensure that the prerequisites for initiating the project are in place",
                    "To establish project tolerances",
                    "To create the Project Initiation Documentation",
                    "To create detailed Stage Plans"
                ],
                correct: 0
            },
            {
                question: "What is a key purpose of Project Assurance?",
                options: [
                    "To create products that meet requirements",
                    "To provide an independent view of project progress",
                    "To develop the project plan",
                    "To create the Business Case"
                ],
                correct: 1
            },
            {
                question: "What is the purpose of a Product Status Account?",
                options: [
                    "To record the financial status of the project",
                    "To provide information about the status of products",
                    "To record daily project activities",
                    "To define the project's products"
                ],
                correct: 1
            },
            {
                question: "Which is the primary output of the 'Initiating a Project' process?",
                options: [
                    "Project Brief",
                    "Project Initiation Documentation",
                    "Stage Plan",
                    "Highlight Report"
                ],
                correct: 1
            },
            {
                question: "What is the purpose of a Team Plan?",
                options: [
                    "To enable the Project Board to authorize a stage",
                    "To enable the Project Manager to control the work of Team Managers",
                    "To plan the activities of the Project Board",
                    "To enable the Team Manager to plan the work of a team"
                ],
                correct: 3
            },
            {
                question: "Which is NOT part of the purpose of the Plans theme?",
                options: [
                    "To facilitate communication",
                    "To define the means to deliver products",
                    "To provide a baseline for progress monitoring",
                    "To define the project management team structure" 
                ],
                correct: 3
            },
            {
                question: "What is the purpose of the Communication Management Approach?",
                options: [
                    "To define project risks",
                    "To define project reporting and timing",
                    "To define the project's products",
                    "To define project tolerances"
                ],
                correct: 1
            },
            {
                question: "Which role is responsible for ensuring the communication needs of the wider stakeholder community are met?",
                options: [
                    "Executive",
                    "Senior User",
                    "Project Manager",
                    "Team Manager"
                ],
                correct: 2
            },
            {
                question: "Which is an objective of the Starting up a Project process?",
                options: [
                    "To create a detailed project plan",
                    "To confirm the project's output acceptance criteria",
                    "To develop the Project Initiation Documentation",
                    "To appoint the Executive and Project Manager"
                ],
                correct: 3
            },
            {
                question: "What is the first step in the risk management procedure?",
                options: [
                    "Estimate risk",
                    "Evaluate risk",
                    "Identify risk",
                    "Implement risk responses"
                ],
                correct: 2
            },
            {
                question: "What does PRINCE2 recommend for managing issues?",
                options: [
                    "Address all issues immediately",
                    "Follow a defined procedure which includes capturing, examining, proposing and deciding",
                    "Delegate all issue resolution to Project Assurance",
                    "Immediately escalate all issues to the Project Board"
                ],
                correct: 1
            },
            {
                question: "Which is the PRINCE2 principle that states a project should focus on defined and agreed products?",
                options: [
                    "Focus on products",
                    "Manage by stages",
                    "Manage by exception",
                    "Tailor to suit the project environment"
                ],
                correct: 0
            },
            {
                question: "What is the purpose of an Exception Report?",
                options: [
                    "To provide information on stage progress",
                    "To inform the Project Board that a stage is forecast to exceed tolerances",
                    "To summarize quality issues",
                    "To document issue resolution"
                ],
                correct: 1
            },
            {
                question: "Which document might contain the risk management procedure tailored for a project?",
                options: [
                    "Risk Register",
                    "Risk Management Approach",
                    "Issue Register",
                    "Daily Log"
                ],
                correct: 1
            },
            {
                question: "What is the purpose of the Lessons Report?",
                options: [
                    "To document any lessons that could be applicable to future projects",
                    "To document the day-to-day progress of a project",
                    "To document issues as they arise",
                    "To summarize the status of risks"
                ],
                correct: 0
            },
            {
                question: "What does PRINCE2 mean?",
                options: [
                    "PRactical INstructions for Creating Environments",
                    "PRojects IN Controlled Environments 2",
                    "PRactical INtegration of Corporate Environments",
                    "PRoject INitiation and Control Environment"
                ],
                correct: 1
            },
            {
                question: "Which of the following is a benefit of using PRINCE2?",
                options: [
                    "Regular reviews of progress against the plan",
                    "Reduction in the need for stakeholder involvement",
                    "Guarantees project success",
                    "Ensures projects are delivered ahead of schedule"
                ],
                correct: 0
            },
            {
                question: "Which process deals with requests for change and off-specifications?",
                options: [
                    "Starting up a Project",
                    "Initiating a Project",
                    "Controlling a Stage", 
                    "Managing Product Delivery"
                ],
                correct: 2
            },
            {
                question: "What is the purpose of the Quality Register?",
                options: [
                    "To define quality requirements for each product",
                    "To record quality activities planned and performed",
                    "To define quality methods for each product",
                    "To document customer quality expectations"
                ],
                correct: 1
            },
            {
                question: "Who is responsible for creating the Quality Management Approach?",
                options: [
                    "Executive",
                    "Senior User",
                    "Project Manager",
                    "Senior Supplier"
                ],
                correct: 2
            },
            // [CONTENT TRUNCATED FOR BREVITY - in a real implementation, this array would contain 500+ questions]
        ];
        
        // Variables to track exam state
        let currentExam = {
            questions: [], 
            allAvailableQuestionsPool: [], 
            answers: [],
            currentQuestionIndex: 0,
            timeLeft: 60 * 60, 
            examStarted: false,
            examFinished: false,
            timerInterval: null
        };
        
        // DOM Elements
        const welcomeScreen = document.getElementById('welcomeScreen');
        const examScreen = document.getElementById('examScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        
        const currentQuestionNumEl = document.getElementById('currentQuestionNum');
        const totalQuestionsEl = document.getElementById('totalQuestions');
        const timerEl = document.getElementById('timer');
        const questionNumberEl = document.getElementById('questionNumber');
        const questionTextEl = document.getElementById('questionText');
        const optionsEl = document.getElementById('options');
        const progressFillEl = document.querySelector('.progress-fill');
        
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        const scorePercentageEl = document.getElementById('scorePercentage');
        const scoreMessageEl = document.getElementById('scoreMessage');
        const correctAnswersEl = document.getElementById('correctAnswers');
        const incorrectAnswersEl = document.getElementById('incorrectAnswers');
        
        const retakeBtn = document.getElementById('retakeBtn');
        const reviewBtn = document.getElementById('reviewBtn');
        const reviewSectionEl = document.getElementById('reviewSection');
        const reviewContentEl = document.getElementById('reviewContent');
        
        // UI initialization
        function init() {
            // Event listeners
            document.getElementById('startExamBtn').addEventListener('click', startExam);
            prevBtn.addEventListener('click', goToPreviousQuestion);
            nextBtn.addEventListener('click', goToNextQuestion);
            submitBtn.addEventListener('click', submitExam);
            retakeBtn.addEventListener('click', retakeExam);
            reviewBtn.addEventListener('click', toggleReview);
            
            submitBtn.style.display = 'none';
            fetchQuestions();
        }
        
        function fetchQuestions() {
            console.log("Simulating fetching questions from a separate module/server...");
            currentExam.allAvailableQuestionsPool = [...questionsDatabase]; 
            console.log(`Successfully "loaded" ${currentExam.allAvailableQuestionsPool.length} questions into the pool.`);
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }
        
        function getRandomQuestions(count) {
            if (!currentExam.allAvailableQuestionsPool || currentExam.allAvailableQuestionsPool.length === 0) {
                console.error("Question pool is empty. Ensure fetchQuestions() was called and completed successfully.");
                return [];
            }
            if (count > currentExam.allAvailableQuestionsPool.length) {
                console.warn(`Requested ${count} questions, but only ${currentExam.allAvailableQuestionsPool.length} are available. Returning all available.`);
                count = currentExam.allAvailableQuestionsPool.length;
            }
            const shuffled = [...currentExam.allAvailableQuestionsPool].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
        
        function updateProgressBar() {
            const progress = ((currentExam.currentQuestionIndex + 1) / currentExam.questions.length) * 100;
            progressFillEl.style.width = `${progress}%`;
        }
        
        function startExam() {
            if (currentExam.allAvailableQuestionsPool.length === 0) {
                alert("Questions are not loaded yet. Please wait a moment or try refreshing.");
                return;
            }
            currentExam.questions = getRandomQuestions(60); 
            
            if (currentExam.questions.length === 0) {
                alert("Failed to load questions for the exam. Please try again.");
                return;
            }

            currentExam.answers = new Array(currentExam.questions.length).fill(null);
            currentExam.currentQuestionIndex = 0;
            currentExam.timeLeft = 60 * 60; 
            currentExam.examStarted = true;
            currentExam.examFinished = false;
            
            totalQuestionsEl.textContent = currentExam.questions.length;
            updateQuestionDisplay();
            updateProgressBar();
            
            welcomeScreen.style.display = 'none';
            resultsScreen.style.display = 'none'; 
            examScreen.style.display = 'block';
            
            startTimer();
        }
        
        function startTimer() {
            if (currentExam.timerInterval) {
                clearInterval(currentExam.timerInterval);
            }
            
            timerEl.classList.remove('warning'); 
            updateTimerDisplay();
            
            currentExam.timerInterval = setInterval(() => {
                currentExam.timeLeft--;
                updateTimerDisplay();
                
                if (currentExam.timeLeft <= 0) {
                    clearInterval(currentExam.timerInterval);
                    submitExam();
                }
                
                if (currentExam.timeLeft <= 300 && currentExam.timeLeft > 0) { 
                    timerEl.classList.add('warning');
                } else {
                    timerEl.classList.remove('warning');
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            timerEl.textContent = formatTime(currentExam.timeLeft);
        }
        
        function updateQuestionDisplay() {
            if (currentExam.questions.length === 0 || !currentExam.questions[currentExam.currentQuestionIndex]) {
                questionTextEl.textContent = "Error: No question to display.";
                optionsEl.innerHTML = '';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                submitBtn.style.display = 'none';
                return;
            }

            const currentQuestion = currentExam.questions[currentExam.currentQuestionIndex];
            const currentAnswerIndex = currentExam.answers[currentExam.currentQuestionIndex];
            
            questionNumberEl.textContent = currentExam.currentQuestionIndex + 1;
            currentQuestionNumEl.textContent = currentExam.currentQuestionIndex + 1;
            questionTextEl.textContent = currentQuestion.question;
            
            optionsEl.innerHTML = '';
            
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                if (currentAnswerIndex === index) {
                    optionElement.classList.add('selected');
                }
                
                optionElement.innerHTML = `
                    <input type="radio" id="option${index}" name="answer" value="${index}" ${currentAnswerIndex === index ? 'checked' : ''}>
                    <label class="option-text" for="option${index}">${option}</label>
                `;
                
                optionElement.addEventListener('click', () => {
                    document.querySelectorAll('#options input[name="answer"]').forEach(rb => rb.checked = false);
                    optionElement.querySelector('input[type="radio"]').checked = true;

                    currentExam.answers[currentExam.currentQuestionIndex] = index;
                    updateQuestionDisplay(); 
                });
                
                optionsEl.appendChild(optionElement);
            });
            
            prevBtn.disabled = currentExam.currentQuestionIndex === 0;
            
            if (currentExam.currentQuestionIndex === currentExam.questions.length - 1) {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            }
        }
        
        function goToPreviousQuestion() {
            if (currentExam.currentQuestionIndex > 0) {
                currentExam.currentQuestionIndex--;
                updateQuestionDisplay();
                updateProgressBar();
            }
        }
        
        function goToNextQuestion() {
            if (currentExam.currentQuestionIndex < currentExam.questions.length - 1) {
                currentExam.currentQuestionIndex++;
                updateQuestionDisplay();
                updateProgressBar();
            }
        }
        
        function calculateScore() {
            let correctCount = 0;
            
            currentExam.questions.forEach((question, index) => {
                if (currentExam.answers[index] === question.correct) {
                    correctCount++;
                }
            });
            
            return {
                correct: correctCount,
                incorrect: currentExam.questions.length - correctCount,
                percentage: currentExam.questions.length > 0 ? Math.round((correctCount / currentExam.questions.length) * 100) : 0
            };
        }
        
        function submitExam() {
            if(currentExam.timerInterval) clearInterval(currentExam.timerInterval);
            currentExam.examFinished = true;
            
            const score = calculateScore();
            
            scorePercentageEl.textContent = score.percentage;
            correctAnswersEl.textContent = score.correct;
            incorrectAnswersEl.textContent = score.incorrect;
            
            const isPassed = score.percentage >= 55; 
            scoreMessageEl.textContent = isPassed 
                ? 'Congratulations! You have passed the PRINCE2 Foundation exam.'
                : 'You have not achieved the passing score of 55%. Keep practicing!';
                
            generateReviewContent();
            
            examScreen.style.display = 'none';
            resultsScreen.style.display = 'block';
        }
        
        function generateReviewContent() {
            reviewContentEl.innerHTML = '';
            
            currentExam.questions.forEach((question, index) => {
                const userAnswer = currentExam.answers[index];
                const isCorrect = userAnswer === question.correct;
                
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';
                
                let optionsHtml = question.options.map((option, optionIndex) => {
                    let className = 'review-option';
                    let indicator = '';

                    if (optionIndex === question.correct) {
                        className += ' correct-answer';
                        indicator = ' (Correct Answer)';
                    }
                    if (optionIndex === userAnswer) {
                        if (!isCorrect) {
                            className += ' user-answer'; 
                            indicator += ' (Your Answer)';
                        } else {
                             indicator = ' (Correct & Your Answer)'; 
                        }
                    }
                    
                    return `<div class="${className}">
                        ${option} ${indicator}
                    </div>`;
                }).join('');

                reviewItem.innerHTML = `
                    <div class="review-question">
                        <strong>Question ${index + 1}:</strong> ${question.question}
                    </div>
                    <div class="review-options">
                        ${optionsHtml}
                    </div>
                    ${userAnswer === null ? '<div style="color: var(--error-color); margin-left: 20px;">Not Answered</div>' : ''}
                `;
                
                reviewContentEl.appendChild(reviewItem);
            });
        }
        
        function toggleReview() {
            const isReviewVisible = reviewSectionEl.style.display === 'block';
            reviewSectionEl.style.display = isReviewVisible ? 'none' : 'block';
            reviewBtn.textContent = isReviewVisible ? 'Hide Review' : 'Review Answers';
        }
        
        function retakeExam() {
            resultsScreen.style.display = 'none';
            welcomeScreen.style.display = 'block';
            
            reviewSectionEl.style.display = 'none';
            reviewBtn.textContent = 'Review Answers';

            timerEl.textContent = formatTime(60*60);
            timerEl.classList.remove('warning');

            currentExam.questions = [];
            currentExam.answers = [];
            currentExam.currentQuestionIndex = 0;
            currentExam.examStarted = false;
            currentExam.examFinished = false;
            if (currentExam.timerInterval) {
                clearInterval(currentExam.timerInterval);
                currentExam.timerInterval = null;
            }
        }
        
        init();
    </script>
</body>
</html>
